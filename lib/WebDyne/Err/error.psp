<html>
<head>
<title>WebDyne Error !{! $_[1]->{'r'}->status !}</title>
<style type="text/css">
        body {font-family:"Verdana";font-weight:normal;font-size: .7em;color:black;} 
        p {font-family:"Verdana";font-weight:normal;color:black;margin-top: -5px}
        b {font-family:"Verdana";font-weight:bold;color:black;margin-top: -5px}
        h1 { font-family:"Verdana";font-weight:normal;font-size:18pt;color:red }
        h2 { font-family:"Verdana";font-weight:normal;font-size:14pt;color:maroon }
        tt {font-family:"Lucida Console";font-size: .9em}
</style>
</head>

<body bgcolor="white">

<h1>WebDyne Error !{! $_[1]->{'r'}->status !}</h1><hr align="left" width="80%" size="1"><h2><i>!{! \&HTTP::Status::status_message($_[1]->{'r'}->status) !}.</i></h2>

<table width="80%">
<tr><td><b>Error: </b></tr></td>

<tr><td bgcolor="#eeeeee">
<tt>
<perl param="@{$_[1]}">

	#  Translate CR's to line breaks so errors are formatted somewhat nicely
	#
	my ($self, $param_ar)=@_;
	my $errstr=$param_ar->[0]->{'errstr'};
	$errstr=&CGI::escapeHTML($errstr);
	$errstr=~s/\n/<br>/g;
	\$errstr;

</perl>

</tt>
</td></tr>

<tr><td>
<br>
<br>
<b>Backtrace: </b>
</td></tr>

<perl param="@{$_[1]}">

	#  Pull out the backtrace from the Error handler internals and present
	#  as nicely as possible
	#
	my ($self, $param_ar)=@_;
	my $errstack_ar=$param_ar->[0]->{'errstack_ar'};
	my $errtrace_ar=$errstack_ar->[0];
        for (my $i=1; defined($errtrace_ar->[$i]); $i++) {

            #  Get method, line no and file
            #
            my $method=$errtrace_ar->[$i+1][3] || $errtrace_ar->[$i][0] ||  last;
            my $line=$errtrace_ar->[$i][2] || next;
	    $self->render_block('backtrace', i=>sprintf('%-2d',$i), package=>$method, line=>$line);

	}
	\undef;


</perl>


<tr><td bgcolor="#eeeeee">
<tt>
<b>#&nbsp;&nbsp;&nbsp;Module</b><br>
<block name="backtrace">
${i}&nbsp;&nbsp;${package}, line ${line}<br>
</block>
</tt></td></tr>


</table>

<br>
<br>

<b>Requested Url: </b>!{! shift()->r->uri().'' !}

<br>
<br>

<hr align="left" width="80%" size="1">

<b>Version Information:</b>&nbsp; WebDyne Version:!{! $WebDyne::VERSION !}

</body>
</html>

__PERL__

use HTTP::Status qw(status_message);
use CGI qw(escapeHTML);

